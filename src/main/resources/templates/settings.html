<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="stylesheet" href="/css/settings.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <title>Settings</title>
</head>
<body>
    <div th:replace="~{fragments/sidebar :: sidebar(currentPage=${currentPage})}"></div>

    <div class="main-content">
        <div class="admin-container">
            <h1><i class="fa-solid fa-user-gear"></i> Profile & System Settings</h1>
            <p class="subtitle">Manage your profile and system configuration</p>

            <div class="admin-tabs">
                <button class="tab-btn" data-tab="profile" th:classappend="${activeTab == 'profile'} ? 'active' : ''">
                    <i class="fa-solid fa-user"></i> Profile
                </button>
                <button class="tab-btn" data-tab="settings" th:classappend="${activeTab == 'settings'} ? 'active' : ''">
                    <i class="fa-solid fa-sliders"></i> System Settings
                </button>
            </div>

            <div id="tab-profile" class="tab-content" th:classappend="${activeTab == 'profile'} ? ' active' : ''">
                <form class="settings-form profile" th:action="@{/settings/profile/update}" th:method="put"
                      th:object="${editProfileRequest}">
                    <h2><i class="fa-solid fa-user-circle"></i> Profile Details</h2>

                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" th:value="${user.username}" readonly>

                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" th:field="*{email}">

                    <label for="firstName">First Name</label>
                    <input type="text" id="firstName" name="firstName" th:field="*{firstName}">

                    <label for="lastName">Last Name</label>
                    <input type="text" id="lastName" name="lastName" th:field="*{lastName}">

                    <p th:if="${#fields.hasErrors('email')}" class="error-message">Invalid email</p>
                    <p th:if="${emailExistsMessage}" th:text="${emailExistsMessage}" class="error-message"></p>
                    <p th:if="${successMessage}" th:text="${successMessage}" class="success-message"></p>

                    <button type="submit"><i class="fa-solid fa-floppy-disk"></i> Save Profile</button>
                </form>
            </div>

            <div id="tab-settings" class="tab-content" th:classappend="${activeTab == 'settings'} ? ' active' : ''">
                <div class="formula-sections">
                    <div class="formula-box">
                        <form class="settings-form" th:action="@{/settings/company/formula/update}" th:method="put">
                            <h2><i class="fa-solid fa-bolt"></i> Company Readings Calculation Formula</h2>

                            <label for="pricePerKwh">Energy Cost per kWh (Lv)</label>
                            <input type="number" id="pricePerKwh" name="pricePerKwh" step="0.01" placeholder="e.g. 0.25"
                                   th:value="${formula != null ? formula.pricePerKwh : 0}">

                            <label for="multiplier">Multiplier</label>
                            <input type="number" id="multiplier" name="multiplier" step="0.05" placeholder="e.g. 13.5"
                                   th:value="${formula != null ? formula.multiplier : 0}">

                            <label for="divider">Divider</label>
                            <input type="number" id="divider" name="divider" step="0.01" placeholder="e.g. 100"
                                   th:value="${formula != null ? formula.divider : 0}">

                            <label for="formula-preview">Formula Preview</label>
                            <textarea id="formula-preview" name="formulaPreview" rows="3" readonly
                                      th:classappend="${formula == null} ? 'error-message' : ''"
                                      th:text="${formula != null
                              ? 'Total Cost = Difference Readings * ' + formula.pricePerKwh + ' * ' + formula.multiplier + ' / ' + formula.multiplier
                              : 'Formula service is currently unavailable. Please try again later.'}">
                            </textarea>

                            <p th:if="${successUpdateMessage}" class="success-message">Successfully updated formula.</p>
                            <p th:if="${successUpdateMessage == false}" class="error-message">Formula service is
                                currently unavailable. Please try again later.</p>

                            <button type="submit"><i class="fa-solid fa-floppy-disk"></i> Save Formula</button>
                        </form>
                    </div>

                    <div class="formula-box">
                        <form class="settings-form formula-box" th:action="@{/settings/meter/formula/update}" th:method="put">
                            <h2><i class="fa-solid fa-gauge"></i> Meter Readings Calculation Formula</h2>

<!--                            <label for="energyPercentage">Energy Percentage (%)</label>-->
<!--                            <input type="number" id="energyPercentage" name="energyPercentage" step="0.01"-->
<!--                                   th:value="${meterFormula != null ? meterFormula.energyPercentage : 0}">-->

                            <label for="meterPricePerKwh">Price per kWh (Lv)</label>
                            <input type="number" id="meterPricePerKwh" name="pricePerKwh" step="0.01"
                                   th:value="${meterFormula != null ? meterFormula.pricePerKwh : 0}">

                            <label for="meterDivider">Divider</label>
                            <input type="number" id="meterDivider" name="divider" step="0.01"
                                   th:value="${meterFormula != null ? meterFormula.divider : 0}">

                            <label for="meter-preview">Formula Preview</label>
                            <textarea id="meter-preview" name="meterPreview" rows="3" readonly
                                      th:classappend="${meterFormula == null} ? 'error-message' : ''"
                                      th:text="${meterFormula != null
                                    ? 'Total Cost = Difference kWh * Energy Percentage / 100 * ' + meterFormula.pricePerKwh +
                                    ' / ' + meterFormula.divider
                                    : 'Meter formula service is currently unavailable. Please try again later.'}">
                            </textarea>

                            <p th:if="${meterSuccess}" class="success-message">Meter formula updated successfully.</p>
                            <p th:if="${meterSuccess == false}" class="error-message">Meter formula service unavailable.</p>

                            <button type="submit"><i class="fa-solid fa-floppy-disk"></i> Save Formula</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script src="/js/sidebar/sidebar.js"></script>
        <script src="/js/admin/admin-tabs.js"></script>
</body>
</html>
